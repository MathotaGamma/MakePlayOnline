<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
    <style>
      html {
        margin: 0px;
        padding: 0px;
        width: 100%;
        height: 100%;
      }
      body {
        display: grid;
        grid-gap: 3px;
        grid-template-rows: 1fr 9fr;
        grid-template-columns: 2fr 1fr 1fr;
        margin: 0px;
        padding: 0px;
        width: 100%;
        height: 100%;
      }
      #textarea {
        grid-row: 1/3;
        grid-column: 1/2;
        margin: 0px;
        border_radius: 0px;
        left: 5%;
        top: 0px;
        width: 100%;
        height: 100%;
      }
      div {
        grid-row: 2/3;
        grid-column: 2/4;
        border: 1px solid;
        width: 100%;
        height: 100%;
      }
      input {
        grid-row: 1/2;
        grid-column: 3/4;
        width: 100%;
        height: 100%;
      }
      
.toggle {
  grid-row: 1/2;
  grid-column: 2/3;
  position: relative;
  width: 78px;
  height: 48px;
  margin: 40px 60px;
  border-radius: 50px;
  overflow: hidden;
  cursor: pointer;
}
.toggle input[type=checkbox] {
  display: none;
}
.toggle:before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: block;
  background: #f45e55;
  -webkit-transition: 0.2s ease-out;
  transition: 0.2s ease-out;
}
.toggle:after {
  content: "OFF";
  position: absolute;
  top: 3px;
  left: 3px;
  width: 42px;
  height: 42px;
  display: block;
  border-radius: 50px;
  background: #fff;
  box-shadow: 0 9px 28px -6px rgba(0, 0, 0, 0.3);
  -webkit-transition: 0.2s ease-out;
  transition: 0.2s ease-out;
  text-align: center;
  padding: 14px 0 0;
  line-height: 1;
  font-size: 14px;
  font-weight: bold;
  color: #df4c43;
  letter-spacing: .5px;
  box-sizing: border-box;
}
.toggle.checked:before {
  background: #24e89c;
}
.toggle.checked:after {
  content: "ON";
  left: 33px;
  box-shadow: 0 9px 28px -6px rgba(0, 0, 0, 0.5);
  color: #16d088;
  padding: 14px 0 0 1px;
}
    </style>
    <title>AI/gemini_api</title>
  </head>
  <body>
    <textarea id="textarea">Hello</textarea>
    <div id="comment"></div>
    <div class="toggle">
      <input type="checkbox" name="check" />
    </div>
    <input type="button" onclick="em();" value="Send">
    <script>
      var socket = io();
      let room = localStorage.getItem('room');
      let id = localStorage.getItem('id');
      let time = Date.now();
      let textarea = document.getElementById('textarea');
      let comment = document.getElementById('comment');
      let emit_tf = false;
      let num = 0;

      setInterval(() => {
        let k_t = textarea.value;
        if(k_t != '' && Date.now()-time >= 2000 && emit_tf){
          em();
        }
      },100);
      
      socket.on('sc_gemini_api', function(data) {
        if(data.room == room && data.id == id){
          comment.innerText = String(num)+':'+data.gen;
        }
        //socket.on('to_room_enter',function(msg) {
          //enter_list = msg.msg;
        //});
        //socket.emit('disconnect_fighters',{data:'leave'});
      });
      function em(){
        num += 1;
        emit_tf = false;
        socket.emit('cs_gemini_api',{room:room,id:id,text:document.getElementById('textarea').value});
      }

      textarea.addEventListener('input',() => {
        emit_tf = true;
        time = Date.now();
      });
    </script>
  </body>
</html>
